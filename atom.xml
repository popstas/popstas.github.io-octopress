<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Popstas]]></title>
  <link href="http://blog.popstas.ru/atom.xml" rel="self"/>
  <link href="http://blog.popstas.ru/"/>
  <updated>2015-12-13T12:29:03+05:00</updated>
  <id>http://blog.popstas.ru/</id>
  <author>
    <name><![CDATA[Stanislav Popov]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Интерактивная Zsh History с поиском и скроллом, Percol]]></title>
    <link href="http://blog.popstas.ru/blog/2015/12/10/interactive-bash-history-with-search/"/>
    <updated>2015-12-10T19:55:20+05:00</updated>
    <id>http://blog.popstas.ru/blog/2015/12/10/interactive-bash-history-with-search</id>
    <content type="html"><![CDATA[<p>Если кто не знает, в bash/zsh есть поиск по истории комманд, если нажать <code>Crrl+R</code> и начать набирать
команду, отобразится последняя команда из истории, для навигации можно использовать
<code>Ctrl+R</code>, <code>Ctrl+Shift+R</code>. При этом видно одновременно видно только одну команду из истории.</p>

<p>Утилита <a href="https://github.com/mooz/percol#zsh-history-search">percol</a> решает эту проблему.</p>

<!-- more -->


<p><img src="http://blog.popstas.ru/images/2015-12/percol.gif"></p>

<p>Собственно по ссылке выше готовый конфиг для zsh. Я немного изменил его под себя,
чтобы использовать percol не только для поиска по истории:</p>

<figure class='code'><figcaption><span>zsh-percol</span><a href='https://github.com/popstas/zsh-config/blob/master/.zshrc'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="k">function</span> exists <span class="o">{</span> which <span class="nv">$1</span> <span class="p">&amp;</span>&gt; /dev/null <span class="o">}</span>
</span><span class='line'><span class="k">if</span> exists percol<span class="p">;</span> <span class="k">then</span>
</span><span class='line'>  <span class="k">function</span> percol_select_history<span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="nb">local </span>tac
</span><span class='line'>      exists gtac <span class="o">&amp;&amp;</span> <span class="nv">tac</span><span class="o">=</span><span class="s2">&quot;gtac&quot;</span> <span class="o">||</span> <span class="o">{</span> exists tac <span class="o">&amp;&amp;</span> <span class="nv">tac</span><span class="o">=</span><span class="s2">&quot;tac&quot;</span> <span class="o">||</span> <span class="o">{</span> <span class="nv">tac</span><span class="o">=</span><span class="s2">&quot;tail -r&quot;</span> <span class="o">}</span> <span class="o">}</span>
</span><span class='line'>      <span class="nv">BUFFER</span><span class="o">=</span><span class="k">$(</span><span class="nb">fc</span> -l -n <span class="m">1</span> <span class="p">|</span> <span class="nb">eval</span> <span class="nv">$tac</span> <span class="p">|</span> percol --query <span class="s2">&quot;$LBUFFER&quot;</span><span class="k">)</span>
</span><span class='line'>      <span class="nv">CURSOR</span><span class="o">=</span><span class="nv">$#BUFFER</span>         <span class="c"># move cursor</span>
</span><span class='line'>      zle -R -c               <span class="c"># refresh</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  zle -N percol_select_history
</span><span class='line'>  bindkey <span class="s1">&#39;^R&#39;</span> percol_select_history
</span><span class='line'>
</span><span class='line'>  <span class="c"># percol based grep</span>
</span><span class='line'>  g<span class="o">()</span> <span class="o">{</span> percol --match-method regex --query<span class="o">=</span><span class="s2">&quot;$*&quot;</span><span class="p">;</span> <span class="o">}</span>
</span><span class='line'><span class="k">fi</span>
</span></code></pre></td></tr></table></div></figure>


<p>Код я добавил в <a href="https://github.com/popstas/zsh-config">свой .zshrc</a>. Если <a href="https://github.com/robbyrussell/oh-my-zsh/pull/4582">этот пулл реквест</a> примут, то данный код появится в составе
<a href="https://github.com/robbyrussell/oh-my-zsh">oh-my-zsh</a> в виде плагина <code>percol</code>.</p>

<p>Код полностью взят со страницы percol, от себя добавил функцию g(), она кстати конфиликтует с плагином git для oh-my-zsh,
зато теперь я могу писать что-то вроде:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>find . -type file <span class="p">|</span> g
</span></code></pre></td></tr></table></div></figure>


<p>для интерактивного выбора результатов поиска и просто для замены grep. При этом доступен мультивыбор по <code>Ctrl+Space</code>.</p>

<p>Пример посложнее:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>vim <span class="k">$(</span>find -name <span class="s2">&quot;*.markdown&quot;</span> <span class="p">|</span> g<span class="k">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>После запуска откроется список всех <code>.markdown</code> файлов в текущей и вложенных папках, выбранный файл сразу откроется в Vim.
Это как будто у вас появилась возможность приделывать midnight commander к результатам поиска!</p>

<p>Смотрите больше интересных примеров <a href="https://github.com/mooz/percol">на странице проекта</a>.</p>

<p>Надо сказать, что на github есть программы с таким же функционалом, как у percol, я об этом узнал на странице самого percol.
Там есть peco, клон percol на Go (а значит поставляется в виде одного бинарника). Мне проще через pip установить percol, так
что с аналогами не сравнивал.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Простой тайм-трекер для отслеживания потраченного времени]]></title>
    <link href="http://blog.popstas.ru/blog/2015/11/22/simple-time-tracker/"/>
    <updated>2015-11-22T09:40:45+05:00</updated>
    <id>http://blog.popstas.ru/blog/2015/11/22/simple-time-tracker</id>
    <content type="html"><![CDATA[<p>На работе у меня часто бывает такое, что не понятно, куда ушло время.
Поэтому написал для себя небольшое приложение, тайм-трекер - <a href="http://time.popstas.ru/">http://time.popstas.ru/</a>
Пользуюсь им уже 2 года, сегодня решил выложить на гитхаб и заодно исправил
глюки, которые раздражали последние годы :)</p>

<!-- more -->


<p>Конечно, перед тем, как написать свое, долго искал что-то похожее.
Самое близкое, что нашел - <a href="https://www.toggl.com/">https://www.toggl.com/</a></p>

<p>Так как я собирался использовать ее постоянно и переключать задачу,
пока человек, прибежавший со срочной задачей ждет, важна была каждая секунда.</p>

<p>time-tracker - простая задачница, решающая большую задачу слежения за собой.</p>

<h3>Фичи:</h3>

<ul>
<li>быстрое добавление задач</li>
<li>подзадачи</li>
<li>быстрое переключение между задачами</li>
<li>исправление времени задним числом</li>
<li>быстрое копирование сводки за день</li>
<li>отслеживание времени по каждой задаче</li>
<li>сводка по задачам</li>
<li>навигация с клавиатуры</li>
</ul>


<h3>Неочевидные моменты</h3>

<ul>
<li>При отслеживании активна всегда только одна задача.</li>
<li>Если включить Desktop notifications, каждые 10 минут будет всплывать сообщение
о том, сколько активна задача с последнего ее запуска и сколько активна всего.</li>
<li>Единственный способ создать второй список задач - открыть другой браузер.</li>
</ul>


<h3>Сценарии применения</h3>

<ul>
<li>постоянное переключение между задачами в течение дня</li>
<li>многодневный проект, когда надо отследить общее потраченное время</li>
<li>быстрый чеклист</li>
</ul>


<p>Для многодневного проекта кстати хочу попробовать связку
<a href="https://trello.com/">Trello</a> + <a href="https://toggl.com/tools">Toggl</a>,
пока писал этот пост, узнал, что у них есть интеграция.</p>

<h3>Как я использую задачницу:</h3>

<p>Прихожу в офис, включаю задачу &ldquo;текучка&rdquo;
После этого ставлю фильтр, чтобы показались задачи с ненулевым временем,
выделяю все, вставляю в блокнот (потом можно вспомнить, чем занимался в
такой-то день, бывает полезно), сбрасываю таймеры (справа от строки ввода),
удаляю ненужное, добавляю то, что сегодня собираюсь делать (1-2 задачи) и
начинаю работать.</p>

<p>Когда ко мне кто-то приходит, и начинает задавать вопросы, я тут же запускаю
в задачах соответствующий проект или &ldquo;прочие консультации&rdquo;, если быстро определить
не удалось.</p>

<p>Чаще всего текущие проекты поделены на несколько подзадач, а внезапно возникающие
просто обозначены проектами.</p>

<h3>Мои постоянные задачи:</h3>

<ul>
<li><code>текучка</code> - вся не классифицируемая мелочь
разбор почты, разбор задач в корпоративной системе.</li>
<li><code>-------</code> - перекуры, наливание чая, прочее ничегонеделание</li>
<li><code>обед</code> - ничегонеделание в обед</li>
<li><code>прочие консультации</code> - разговоры на рабочие темы</li>
<li><code>сисадминство</code> - работы по серверу</li>
<li>несколько задач с проектами, которые постоянно всплывают</li>
</ul>


<h2>Техническая часть</h2>

<ul>
<li>Backbone (использовал в первый и последний раз)</li>
<li>LESS, шрифтовые иконки</li>
<li>Хранилище данных в LocalStorage браузера</li>
</ul>


<p>Одной из причин написать было желание потрогать backbone.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Показать все окна Gnome Terminal в Ubuntu]]></title>
    <link href="http://blog.popstas.ru/blog/2015/11/16/show-all-terminal-windows-in-ubuntu/"/>
    <updated>2015-11-16T23:55:17+05:00</updated>
    <id>http://blog.popstas.ru/blog/2015/11/16/show-all-terminal-windows-in-ubuntu</id>
    <content type="html"><![CDATA[<p>При работе за компом имею привычку открывать много терминалов,
не группируя их по вкладкам, рабочим столам или менеджером терминалов типа tmux.
При этом терминалы расположены по всему рабочему экрану.</p>

<p>Из-за этого была такая проблема: при переключении на браузер или редактор,
которые обычно занимают по полэкрана, все терминалы оказывались под большими окнами.</p>

<p>Придумал решение: нужно, чтобы можно было выбрать один терминал (который обычно доступен по Alt-Tab),
нажать хоткей и достать все окна этой же программы наверх.</p>

<!-- more -->


<h4>Для этого нужно:</h4>

<ul>
<li>определить текущее окно</li>
<li>определить его класс</li>
<li>найти все окна с тем же классом</li>
<li>активировать каждое из окон</li>
</ul>


<p>Для манипуляции с окнами из консоли использовал <code>xdotool</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo aptitude install xdotool
</span></code></pre></td></tr></table></div></figure>


<p>Через полчаса родился страшный однострочник, в итоге из него получился такой скрипт:</p>

<figure class='code'><figcaption><span>windows-activate</span><a href='https://gist.github.com/popstas/9e1641e39abbda6392f1'>link</a></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'><span class="c"># </span>
</span><span class='line'><span class="c"># Activate all windows with process name of currently active window</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Получить текущее активное окно, его pid, имя процесса</span>
</span><span class='line'><span class="nv">current_pid</span><span class="o">=</span><span class="k">$(</span>xdotool getwindowpid <span class="k">$(</span>xdotool getactivewindow<span class="k">))</span>
</span><span class='line'><span class="nv">current_name</span><span class="o">=</span><span class="k">$(</span>ps -p <span class="nv">$current_pid</span> -o <span class="nv">comm</span><span class="o">=</span><span class="k">)</span>
</span><span class='line'><span class="nv">clean_name</span><span class="o">=</span><span class="k">${</span><span class="nv">current_name</span><span class="p">%-</span><span class="k">}</span>
</span><span class='line'>
</span><span class='line'><span class="nv">name</span><span class="o">=</span><span class="k">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">$clean_name</span><span class="k">}</span>
</span><span class='line'>
</span><span class='line'><span class="c"># найти окна процесса (только видимые), активировать каждое из них</span>
</span><span class='line'>xdotool search --onlyvisible --class <span class="s2">&quot;$name&quot;</span> <span class="se">\</span>
</span><span class='line'>  <span class="p">|</span> xargs -L1 --no-run-if-empty xdotool windowactivate
</span></code></pre></td></tr></table></div></figure>


<h3>Какие были проблемы:</h3>

<ul>
<li>У каждого процесса оказалось штук по 5 &ldquo;окон&rdquo;, которые на самом деле не видны</li>
<li>Текущий процесс <code>gnome-terminal</code> виден в процессах как <code>gnome-terminal-server</code>,
в процессах имя не входит и отображается как <code>gnome-terminal-</code>,
в этом месте был вбит костыль, добавлена обрезка дефиса в конце.</li>
</ul>


<p>Скрипт был сохранен в /usr/local/bin/window-activate и через <code>ccsm</code> (Compiz config settings manager) повешен на хоткей.</p>

<p>Скрипт можно вызывать, передав параметром имя процесса, иначе возьмет его из текущего окна.</p>
]]></content>
  </entry>
  
</feed>
